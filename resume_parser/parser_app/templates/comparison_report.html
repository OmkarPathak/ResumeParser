{% extends 'base.html' %}
{% load static %}

{% block title %}AI Candidate Comparison{% endblock %}

{% block content %}
<div class="container-fluid mt-4 mb-5">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="h3 font-weight-bold mb-1">AI Candidate Comparison</h2>
            <p class="text-secondary small mb-0">Side-by-Step analysis powered by AI.</p>
        </div>
        <a href="{% url 'resumes_list' %}" class="btn btn-outline-secondary shadow-sm">
            <i class="fas fa-arrow-left mr-2"></i>Back to List
        </a>
    </div>

    <!-- AI Verdict Card -->
    <div class="card border-0 shadow-lg mb-5 overflow-hidden" style="border-radius: 20px;">
        <div class="card-body p-0">
            <div class="row no-gutters">
                <!-- Left Side: Winner Highlight -->
                <div class="col-md-4 bg-gradient-premium p-5 text-center d-flex flex-column justify-content-center text-white">
                    <div class="mb-3 animate__animated animate__bounceIn">
                        <span class="fa-stack fa-3x">
                            <i class="fas fa-certificate fa-stack-2x text-white-50"></i>
                            <i class="fas fa-trophy fa-stack-1x text-warning"></i>
                        </span>
                    </div>
                    <h6 class="text-uppercase font-weight-bold mb-2" style="letter-spacing: 2px; opacity: 0.8;">Top Choice</h6>
                    <h2 class="font-weight-bold mb-3 text-white" style="font-size: 2.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">{{ comparison.winner }}</h2>
                    <div class="mt-2">
                        <span class="badge badge-light text-primary px-3 py-2 rounded-pill shadow-sm font-weight-bold">
                            <i class="fas fa-check-circle mr-1"></i> Highest Recommendation
                        </span>
                    </div>
                </div>
                
                <!-- Right Side: Analysis -->
                <div class="col-md-8 p-5 bg-white d-flex flex-column justify-content-center">
                    <h5 class="font-weight-bold text-dark mb-4 d-flex align-items-center">
                        <span class="icon-box bg-soft-primary text-primary rounded-circle mr-3">
                            <i class="fas fa-brain"></i>
                        </span>
                        Why this candidate?
                    </h5>
                    <div class="bg-light p-4 rounded-lg" style="border-left: 4px solid #4e73df;">
                        <p class="mb-0 text-dark" style="font-size: 1.0rem; line-height: 1.6; color: #4a5568;">
                            {{ comparison.reasoning }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Matrix -->
    <div class="row">
        {% for cand in comparison.candidates %}
        <div class="col-md-6 col-xl-4 mb-4">
            <div class="card h-100 border-0 shadow-sm hover-shadow-lg" style="border-radius: 12px; transition: transform 0.2s;">
                <div class="card-header bg-white border-bottom-0 pt-4 pb-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="font-weight-bold text-dark mb-0 truncate" title="{{ cand.name }}">{{ cand.name }}</h4>
                        {% if cand.name == comparison.winner %}
                        <span class="badge badge-warning text-white shadow-sm"><i class="fas fa-star"></i> Winner</span>
                        {% endif %}
                    </div>
                    <div class="mt-2">
                         <div class="progress" style="height: 8px; border-radius: 4px;">
                            <div class="progress-bar {% if cand.rating >= 8 %}bg-success{% elif cand.rating >= 6 %}bg-warning{% else %}bg-danger{% endif %}" 
                                 role="progressbar" style="width: {{ cand.rating|floatformat:0 }}0%;" 
                                 aria-valuenow="{{ cand.rating }}" aria-valuemin="0" aria-valuemax="10"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span class="small text-muted font-weight-bold">Fit Score</span>
                            <span class="small font-weight-bold {% if cand.rating >= 8 %}text-success{% elif cand.rating >= 6 %}text-warning{% else %}text-danger{% endif %}">{{ cand.rating|floatformat:1 }}/10</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <h6 class="text-uppercase text-secondary small font-weight-bold mb-2">
                            <i class="fas fa-thumbs-up text-success mr-2"></i> Key Strengths
                        </h6>
                        <ul class="list-unstyled mb-0">
                            {% for strength in cand.strengths %}
                            <li class="mb-2 d-flex align-items-start text-dark small">
                                <i class="fas fa-check-circle text-success mt-1 mr-2" style="font-size: 0.8rem;"></i>
                                {{ strength }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="mb-4">
                        <h6 class="text-uppercase text-secondary small font-weight-bold mb-2">
                            <i class="fas fa-exclamation-triangle text-warning mr-2"></i> Potential Gaps
                        </h6>
                        <ul class="list-unstyled mb-0">
                            {% for weak in cand.weaknesses %}
                            <li class="mb-2 d-flex align-items-start text-dark small">
                                <i class="fas fa-minus-circle text-warning mt-1 mr-2" style="font-size: 0.8rem;"></i>
                                {{ weak }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="bg-light p-3 rounded">
                        <h6 class="text-uppercase text-secondary small font-weight-bold mb-2">
                            <i class="fas fa-gavel text-primary mr-2"></i> Verdict
                        </h6>
                        <p class="small text-dark mb-0 font-italic">"{{ cand.verdict }}"</p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .bg-gradient-premium {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .bg-soft-primary {
        background-color: rgba(78, 115, 223, 0.1);
    }
    .icon-box {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
    .avatar-placeholder {
         width: 50px;
         height: 50px;
         background-color: #e3e6f0;
         color: #858796;
         border-radius: 50%;
         display: flex;
         align-items: center;
         justify-content: center;
         font-weight: bold;
         font-size: 1.2rem;
    }
    .hover-shadow-lg:hover {
        transform: translateY(-5px);
        box-shadow: 0 1rem 3rem rgba(0,0,0,.175)!important;
    }
</style>
{% endblock %}
