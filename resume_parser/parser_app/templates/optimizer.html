{% extends 'base.html' %}
{% load static %}

{% block title %}Resume Parser | Resume Optimizer{% endblock %}

{% block content %}
<style>
    :root {
        --glass-bg: rgba(255, 255, 255, 0.7);
        --glass-border: rgba(255, 255, 255, 0.4);
        --accent-indigo: #6366f1;
        --accent-emerald: #10b981;
        --accent-rose: #f43f5e;
        --accent-amber: #f59e0b;
        --text-slate: #334155;
    }

    .premium-page-title {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
        letter-spacing: -0.025em;
    }

    .glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .glass-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02);
    }

    .modern-form-control {
        border: 2px solid transparent;
        background-color: #f1f5f9;
        border-radius: 12px;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
        font-weight: 500;
        color: var(--text-slate);
    }

    .modern-form-control:focus {
        background-color: #fff;
        border-color: var(--accent-indigo);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        color: #1e293b;
    }

    .premium-btn {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        border: none;
        border-radius: 14px;
        padding: 1rem;
        font-weight: 700;
        letter-spacing: 0.025em;
        transition: all 0.3s ease;
    }

    .premium-btn:hover {
        transform: scale(1.02);
        box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
    }

    .score-circle {
        position: relative;
        width: 120px;
        height: 120px;
    }

    .score-svg {
        transform: rotate(-90deg);
    }

    .score-bg {
        fill: none;
        stroke: #e2e8f0;
        stroke-width: 10;
    }

    .score-progress {
        fill: none;
        stroke: var(--accent-indigo);
        stroke-width: 10;
        stroke-linecap: round;
        transition: stroke-dashoffset 1s ease-out;
    }

    .score-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-weight: 800;
        font-size: 1.5rem;
        color: #1e293b;
    }

    .insight-pill {
        background: white;
        border-left: 5px solid transparent;
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease;
    }

    .insight-pill:hover {
        transform: translateX(5px);
    }

    .insight-pill.strength { border-color: var(--accent-emerald); }
    .insight-pill.gap { border-color: var(--accent-rose); }
    .insight-pill.suggestion { border-color: var(--accent-indigo); }
    .insight-pill.action { border-color: var(--accent-amber); }

    .section-header {
        font-weight: 700;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #64748b;
        margin-bottom: 1.5rem;
    }
</style>

<div class="row pt-5">
    <div class="col-12 mb-5">
        <h1 class="premium-page-title display-4"><i class="fas fa-magic mr-2" style="color: var(--accent-indigo);"></i> AI Resume Optimizer</h1>
        <p class="text-muted lead">Next-generation alignment analysis between your profile and job requirements powered by LLMs.</p>
    </div>
</div>

<div class="row">
    <!-- Configuration Sidebar -->
    <div class="col-lg-4 mb-4">
        <div class="glass-card card border-0">
            <div class="card-body p-4">
                <form method="POST" id="optimize-form">
                    {% csrf_token %}
                    
                    <div class="form-group mb-4">
                        <label class="font-weight-bold text-slate small mb-2">
                           Target Resume
                        </label>
                        <select name="resume_id" class="form-control modern-form-control" required>
                            <option value="" disabled selected>Select from database...</option>
                            {% for resume in resumes %}
                                <option value="{{ resume.id }}" {% if selected_resume_id == resume.id %}selected{% endif %}>
                                    {{ resume.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group mb-5">
                        <label class="font-weight-bold text-slate small mb-2">
                            Job Description
                        </label>
                        <textarea name="job_description" class="form-control modern-form-control" rows="12" placeholder="Paste JD content here..." required style="resize: none;">{{ job_description }}</textarea>
                    </div>

                    <button type="submit" id="optimize-btn" class="btn premium-btn btn-primary d-flex align-items-center justify-content-center w-100">
                        <span id="btn-text">
                            <i class="fas fa-robot mr-2"></i> AI Compute Optimization
                        </span>
                        <span id="btn-loader" style="display: none;">
                            <i class="fas fa-spinner fa-spin mr-2"></i> Processing AI Engine...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Analytics Dashboard -->
    <div class="col-lg-8">
        {% if results %}
            <div class="row">
                <!-- Score & Key Stats -->
                <div class="col-md-4 mb-4">
                    <div class="glass-card card border-0 h-100 text-center">
                        <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                             <div class="section-header w-100"><i class="fas fa-robot mr-1"></i> AI Match Score</div>
                            <div class="score-circle mb-3">
                                <svg class="score-svg" width="120" height="120">
                                    <circle class="score-bg" cx="60" cy="60" r="50"></circle>
                                    <circle class="score-progress" cx="60" cy="60" r="50" 
                                            style="stroke-dasharray: 314.159; stroke-dashoffset: 314.159;"></circle>
                                </svg>
                                <div class="score-text">{{ results.match_score }}%</div>
                            </div>
                            <p class="text-muted small mt-2">
                                {% if results.score_reasoning %}
                                    {{ results.score_reasoning }}
                                {% else %}
                                    Alignment based on skills, experience, and education metadata.
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <div class="col-md-8 mb-4">
                    <div class="glass-card card border-0 h-100">
                        <div class="card-body p-4">
                            <div class="section-header">Immediate Roadmap</div>
                            <div class="action-list">
                                {% for item in results.action_items %}
                                    <div class="insight-pill action d-flex align-items-start">
                                        <div class="mr-3 mt-1">
                                            <div class="rounded-circle bg-amber p-1 text-white d-flex align-items-center justify-content-center" style="width: 24px; height: 24px; background: var(--accent-amber); font-size: 0.7rem;">
                                                {{ forloop.counter }}
                                            </div>
                                        </div>
                                        <div class="text-slate font-weight-500">{{ item }}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deep Insights -->
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="section-header ml-2">Matching Strengths</div>
                    {% for strength in results.strengths %}
                        <div class="insight-pill strength">
                            <i class="fas fa-check-circle text-emerald mr-2" style="color: var(--accent-emerald);"></i>
                            <span class="text-slate font-weight-500">{{ strength }}</span>
                        </div>
                    {% endfor %}
                </div>

                <div class="col-md-6 mb-4">
                    <div class="section-header ml-2">Critical Gaps</div>
                    {% for gap in results.gaps %}
                        <div class="insight-pill gap">
                            <i class="fas fa-exclamation-circle text-rose mr-2" style="color: var(--accent-rose);"></i>
                            <span class="text-slate font-weight-500">{{ gap }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="row mt-2">
                <div class="col-12 mb-4">
                    <div class="glass-card card border-0">
                        <div class="card-body p-5">
                            <div class="section-header">Editorial Suggestions</div>
                            <div class="row">
                                {% for suggestion in results.suggestions %}
                                    <div class="col-md-6">
                                        <div class="insight-pill suggestion h-100">
                                            <div class="d-flex">
                                                <i class="fas fa-lightbulb mt-1 mr-3" style="color: var(--accent-indigo);"></i>
                                                <div class="text-slate font-weight-500">{{ suggestion }}</div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        {% else %}
            <!-- Empty State -->
            <div class="glass-card card border-0 h-100 d-flex align-items-center justify-content-center text-center p-5">
                <div class="p-5">
                    <div class="mb-4" style="font-size: 5rem; opacity: 0.1;">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <h3 class="font-weight-bold text-slate mb-3">AI Engine Ready</h3>
                    <p class="text-muted lead px-lg-5">Configure your parameters on the left to start the deep alignment analysis. We'll compare hard skills, industry experience, and academic relevance.</p>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script>
    document.getElementById('optimize-form').addEventListener('submit', function() {
        const btn = document.getElementById('optimize-btn');
        const text = document.getElementById('btn-text');
        const loader = document.getElementById('btn-loader');
        
        btn.classList.add('disabled');
        btn.style.opacity = '0.8';
        text.style.display = 'none';
        loader.style.display = 'inline-block';
    });

    // Animate the score circle if it exists
    window.addEventListener('load', () => {
        const progress = document.querySelector('.score-progress');
        if (progress) {
            const score = parseInt("{{ results.match_score|default:0 }}");
            const circumference = 2 * Math.PI * 50;
            const offset = circumference - (score / 100) * circumference;
            setTimeout(() => {
                progress.style.strokeDashoffset = offset;
            }, 100);
        }
    });
</script>
{% endblock %}
