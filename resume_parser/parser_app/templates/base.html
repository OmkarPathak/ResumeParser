<!doctype html>
{% load static %}
{% load active %}
{% load crispy_forms_tags %}
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Facebook Cards -->
  <meta property="og:description" content="A fun project to store my learning from each book that I read" />
  <meta property="og:url" content="" />
  <meta property="og:image" content="{% static 'images/logomark.png' %}" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Bookworm" />

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@omkarpathak27">
  <meta name="twitter:creator" content="Omkar Pathak">
  <meta name="twitter:title" content="Bookworm">
  <meta name="twitter:description" content="A fun project to store my learning from each book that I read">
  <meta name="twitter:creator" content="Omkar Pathak">
  <meta name="twitter:image:src" content="{% static 'images/logomark.png' %}">
  <meta name="twitter:domain" content="https://www.omkarpathak.in">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
    integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css" type="text/css"
    media="all" />
  <link rel="stylesheet" href="{% static 'css/custom.css' %}">
  <link rel="shortcut icon" href="{% static 'images/logomarkv2.ico' %}">
  <script>
    // --- GLOBAL LOADER LOGIC ---
    (function() {
        const loaderMessages = {
            'parsing': ["Parsing resume contents", "Reading resume contents", "Parsing and extracting different sections from resume", "Finalising the extraction", "Saving results"],
            'matching': ["Analyzing Job Description", "Scanning recruiter database", "Calculating match scores", "Ranking candidates", "Finalizing results"],
            'chatting': ["Connecting to AI Agent", "Searching through resumes", "Analyzing content", "Generating response", "Finalizing answer"],
            'deleting': ["Deleting records...", "Cleaning up database...", "Removing associated files...", "Refreshing state..."],
            'default': ["Processing...", "Hold on a moment...", "Almost there...", "Wrapping up..."]
        };

        let messageInterval = null;

        function showLoader(action = 'default') {
            const loader = document.getElementById('global-loader');
            const container = document.getElementById('loader-msg-container');
            if (!loader || !container) return;
            
            action = (action || 'default').toLowerCase();
            if (loader.getAttribute('data-loader-running') === action) return;
            loader.setAttribute('data-loader-running', action);
            
            const messages = loaderMessages[action] || loaderMessages['default'];
            
            // Rebuild container children
            container.innerHTML = messages.map(m => `<div class="loader-msg">${m.toUpperCase()}</div>`).join('');
            
            // Clear old classes and add new ones
            container.className = 'loader-msg-container';
            if (messages.length === 5) {
                container.classList.add('rotate-5');
            } else if (messages.length === 4) {
                container.classList.add('rotate-4');
            }
            
            // Show visually
            loader.style.display = 'flex';
            loader.classList.add('visible');
        }

        function hideLoader() {
            const loader = document.getElementById('global-loader');
            const container = document.getElementById('loader-msg-container');
            if (loader) {
                loader.style.display = 'none';
                loader.classList.remove('visible');
                loader.removeAttribute('data-loader-running');
            }
            if (container) {
                container.className = 'loader-msg-container';
                container.innerHTML = '';
            }
    
        }

        window.showLoader = showLoader;
        window.hideLoader = hideLoader;

        // Auto-attach listeners
        document.addEventListener('submit', function(e) {
    
            const action = e.target.getAttribute('data-loader-action') || 'default';
            showLoader(action);
        }, true);

        document.addEventListener('click', function(e) {
            const link = e.target.closest('a');
            if (link) {
                const href = link.getAttribute('href');
                if (href && !href.startsWith('#') && !href.startsWith('mailto:') && !href.startsWith('tel:') && !link.target && !link.hasAttribute('data-toggle')) {
                    if (href.includes('://') && !href.startsWith(window.location.origin)) return;
            
                    showLoader(link.getAttribute('data-loader-action') || 'default');
                }
            }
        }, true);

        window.addEventListener('pageshow', (e) => { if (e.persisted) hideLoader(); });
        window.addEventListener('load', hideLoader);
    })();
  </script>
  <title>{% block title %}{% endblock %}</title>
</head>

<body style="background-color: var(--bg-body);">
  <!-- Global Loader -->
  <div id="global-loader">
      <div class="spinner-ring"></div>
      <div class="loader-text">
          <div class="loader-msg-container" id="loader-msg-container">
              <div class="loader-msg">INITIALIZING...</div>
          </div>
      </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      {% include 'sidebar.html' %} 

      <!-- Main Content -->
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4 {% block container_class %}py-4{% endblock %}">
        {% include 'messages.html' %}
        
        {% block content %}
        {% endblock %}
      </main>
    </div>
  </div>

  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  
  
  {% block javascript %}{% endblock %}
</body>

</html>